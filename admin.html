<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli - Kasa Kontrol</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            background-color: #0e0e0e; 
            color: white; 
            font-family: 'Poppins', sans-serif; 
            padding: 20px;
            margin: 0;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #e84242;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .admin-header h1 { color: #e84242; font-size: 2.2rem; margin: 0; }

        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .admin-main-layout {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .left-content { flex: 3; }
        .right-content { flex: 1; min-width: 300px; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #e84242;
        }

        .stat-card h3 { color: #888; font-size: 1.2rem; margin: 0; }
        .stat-card .value { font-size: 1.8rem; font-weight: bold; color: #fff; margin-top: 5px; }

        .admin-tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .admin-masa-kutu {
            background: #0a140a; 
            border: 2px solid #2ecc71;
            border-radius: 15px;
            padding: 20px 10px;
            text-align: center;
            transition: 0.3s;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .admin-masa-kutu.dolu { background: #1a0a0a; border-color: #e84242; }
        .admin-masa-kutu i { font-size: 30px; color: #2ecc71; margin-bottom: 10px; }
        .admin-masa-kutu.dolu i { color: #e84242; }

        .btn-odendi {
            display: none; 
            margin-top: 10px;
            padding: 8px 15px;
            background: #e84242;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }
        .admin-masa-kutu.dolu .btn-odendi { display: inline-block; }

        .rapor-paneli {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 20px;
            border: 1px solid #333;
        }

        .rapor-paneli h2 { color: #e84242; font-size: 1.6rem; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }

        .gunluk-rapor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #222;
        }

        .rapor-tarih { color: #888; font-size: 1rem; }
        .rapor-tutar { color: #2ecc71; font-weight: bold; font-size: 1.1rem; }

        .btn-gun-kapat {
            width: 100%;
            padding: 12px;
            background: #2ecc71;
            color: #000;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            transition: 0.3s;
        }

        .btn-gun-kapat:hover { background: #27ae60; }

        .btn-return { padding: 8px 20px; border: 2px solid #e84242; color: #e84242; text-decoration: none; border-radius: 20px; font-weight: bold; transition: 0.3s; }
        .btn-return:hover { background: #e84242; color: white; }

        .btn-logout { padding: 8px 20px; background: #e84242; color: white; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-logout:hover { background: white; color: #e84242; }

        .urun-yonetim-container {
            margin-top: 40px;
            background: #1a1a1a;
            padding: 25px;
            border-radius: 20px;
            border: 1px solid #333;
        }
        .urun-form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .urun-form-row input, .urun-form-row select {
            background: #0e0e0e;
            border: 1px solid #444;
            color: white;
            padding: 12px;
            border-radius: 8px;
            outline: none;
        }
        .btn-urun-ekle {
            background: #e84242;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .product-list-wrapper {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            border-top: 1px solid #333;
            padding-top: 20px;
        }

        .category-sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .category-btn {
            background: #0e0e0e;
            color: white;
            border: 1px solid #444;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: 0.3s;
        }

        .category-btn:hover, .category-btn.active {
            background: #e84242;
            border-color: #e84242;
        }

        .product-table-area { flex: 3; }

        .admin-urun-tablo {
            width: 100%;
            border-collapse: collapse;
        }
        .admin-urun-tablo th, .admin-urun-tablo td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #333;
        }
        .btn-sil {
            background: #ff4d4d;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn-duzenle {
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
        }

        .btn-masa-sil {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            color: #555;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            transition: 0.3s;
        }
        .btn-masa-sil:hover { color: #ff4d4d; }

        @media (max-width: 1100px) { 
            .admin-main-layout { flex-direction: column; } 
            .right-content { width: 100%; } 
            .product-list-wrapper { flex-direction: column; }
        }
    </style>
</head>
<body>

    <script>
        if (sessionStorage.getItem('admin_auth') !== 'true') {
            window.location.href = 'login.html?to=admin';
        }
    </script>

    <div class="admin-header">
        <h1><i class="fas fa-cash-register"></i> ADMIN / KASA KONTROL</h1>
        <div class="header-buttons">
            <a href="index.html" class="btn-return">Siteye Dön</a>
            <button class="btn-logout" onclick="adminLogout()">Güvenli Çıkış</button>
        </div>
    </div>

    <div class="admin-main-layout">
        <div class="left-content">
            <div class="stats-grid">
                <div class="stat-card"><h3>Bugünkü Ciro</h3><div class="value" id="admin-ciro">0.00 TL</div></div>
                <div class="stat-card"><h3>Tahsil Edilen Masa</h3><div class="value" id="admin-siparis-sayisi">0</div></div>
                <div class="stat-card"><h3>Bekleyen Tahsilat</h3><div class="value" id="admin-bekleyen">0.00 TL</div></div>
            </div>

            <div class="admin-tables-grid" id="admin-tables-container"></div>

            <div class="urun-yonetim-container" style="margin-top: 20px;">
                <h2 style="color: #e84242; margin-bottom: 20px;"><i class="fas fa-chair"></i> Masa Ekle</h2>
                <div class="urun-form-row">
                    <input type="text" id="yeni-masa-ad" placeholder="Masa Adı (Örn: Masa 11)">
                    <button class="btn-urun-ekle" onclick="masaEkle()">Masa Ekle</button>
                </div>
            </div>

            <div class="urun-yonetim-container" style="margin-top:20px;">
                <h2 style="color: #e84242; margin-bottom: 20px;"><i class="fas fa-user-plus"></i> Garson Yönetimi</h2>
                <div class="urun-form-row">
                    <input type="text" id="yeni-garson-ad" placeholder="Garson Adı">
                    <input type="password" id="yeni-garson-sifre" placeholder="Şifre Atayın">
                    <button class="btn-urun-ekle" onclick="garsonEkle()">Garson Ekle</button>
                </div>
                <table class="admin-urun-tablo">
                    <thead>
                        <tr>
                            <th>Garson Adı</th>
                            <th>Şifre</th>
                            <th>İşlem</th>
                        </tr>
                    </thead>
                    <tbody id="admin-garson-listesi"></tbody>
                </table>
            </div>

            <div class="urun-yonetim-container">
                <h2 style="color: #e84242; margin-bottom: 20px;"><i class="fas fa-plus-circle"></i> Ürün Yönetimi</h2>
                
                <div class="urun-form-row">
                    <input type="text" id="yeni-urun-ad" placeholder="Ürün Adı">
                    <input type="number" id="yeni-urun-fiyat" placeholder="Fiyat (TL)">
                    <select id="yeni-urun-kategori">
                        <option value="menu">Bizim Menümüz</option>
                        <option value="featured">Öne Çıkan Ürünler</option>
                        <option value="desserts">Nefis Tatlılar</option>
                        <option value="hot-drinks">Sıcak İçecekler</option>
                        <option value="cold-drinks">Soğuk İçecekler</option>
                    </select>
                    <input type="text" id="yeni-urun-resim" placeholder="Resim Yolu (images/...)">
                    <button id="btn-urun-ekle-main" class="btn-urun-ekle" onclick="urunEkle()">Ekle</button>
                </div>

                <div class="product-list-wrapper">
                    <div class="category-sidebar">
                        <button class="category-btn active" onclick="setCategoryFilter('all', this)">Tümü</button>
                        <button class="category-btn" onclick="setCategoryFilter('menu', this)">Bizim Menümüz</button>
                        <button class="category-btn" onclick="setCategoryFilter('featured', this)">Öne Çıkanlar</button>
                        <button class="category-btn" onclick="setCategoryFilter('desserts', this)">Nefis Tatlılar</button>
                        <button class="category-btn" onclick="setCategoryFilter('hot-drinks', this)">Sıcak İçecekler</button>
                        <button class="category-btn" onclick="setCategoryFilter('cold-drinks', this)">Soğuk İçecekler</button>
                    </div>

                    <div class="product-table-area">
                        <table class="admin-urun-tablo">
                            <thead>
                                <tr>
                                    <th>Ad</th>
                                    <th>Fiyat</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="admin-urun-listesi-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-content">
            <button class="btn-gun-kapat" onclick="gunuKapat()">GÜNÜ KAPAT VE KAYDET</button>
            <div class="rapor-paneli">
                <h2><i class="fas fa-history"></i> Günlük Raporlar</h2>
                <div id="rapor-listesi">
                    </div>
            </div>
        </div>
    </div>

    <script>
        function adminLogout() {
            if (confirm("Admin panelinden çıkış yapmak istediğinize emin misiniz?")) {
                sessionStorage.removeItem('admin_auth');
                // Burası değişti: artık ana sayfaya (index.html) yönlendiriyor
                window.location.href = 'index.html';
            }
        }

        let currentCategoryFilter = 'all';
        let duzenlenenUrunId = null;

        function varsayilanMasalariKur() {
            let masalar = JSON.parse(localStorage.getItem("kafe_masalari"));
            if (!masalar || masalar.length === 0) {
                masalar = [];
                for (let i = 1; i <= 10; i++) { masalar.push("Masa " + i); }
                localStorage.setItem("kafe_masalari", JSON.stringify(masalar));
            }
        }

        function masaEkle() {
            const masaAd = document.getElementById('yeni-masa-ad').value.trim();
            if (!masaAd) { alert("Lütfen bir masa adı girin!"); return; }
            let masalar = JSON.parse(localStorage.getItem("kafe_masalari")) || [];
            if (masalar.includes(masaAd)) { alert("Bu masa zaten mevcut!"); return; }
            masalar.push(masaAd);
            localStorage.setItem("kafe_masalari", JSON.stringify(masalar));
            document.getElementById('yeni-masa-ad').value = "";
            adminGuncelle();
        }

        function masaSil(masaAd) {
            const orders = JSON.parse(localStorage.getItem("orders")) || [];
            if (orders.find(o => o.table.trim() === masaAd)) {
                alert("Bu masa dolu olduğu için silemezsiniz!");
                return;
            }
            if (confirm(masaAd + " silinecektir. Emin misiniz?")) {
                let masalar = JSON.parse(localStorage.getItem("kafe_masalari")) || [];
                masalar = masalar.filter(m => m !== masaAd);
                localStorage.setItem("kafe_masalari", JSON.stringify(masalar));
                adminGuncelle();
            }
        }

        function garsonEkle() {
            const isim = document.getElementById('yeni-garson-ad').value.trim();
            const sifre = document.getElementById('yeni-garson-sifre').value.trim();
            if (!isim || !sifre) { alert("Garson adı ve şifre boş bırakılamaz!"); return; }
            let garsonlar = JSON.parse(localStorage.getItem("kafe_garsonlari")) || [];
            if (garsonlar.find(g => g.isim === isim)) { alert("Bu isimde bir garson zaten var!"); return; }
            garsonlar.push({ id: Date.now(), isim, sifre });
            localStorage.setItem("kafe_garsonlari", JSON.stringify(garsonlar));
            document.getElementById('yeni-garson-ad').value = "";
            document.getElementById('yeni-garson-sifre').value = "";
            garsonListesiniGuncelle();
        }

        function garsonSil(id) {
            if(confirm("Garsonu silmek istediğinize emin misiniz?")) {
                let garsonlar = JSON.parse(localStorage.getItem("kafe_garsonlari")) || [];
                garsonlar = garsonlar.filter(g => g.id !== id);
                localStorage.setItem("kafe_garsonlari", JSON.stringify(garsonlar));
                garsonListesiniGuncelle();
            }
        }

        function garsonListesiniGuncelle() {
            const listBody = document.getElementById('admin-garson-listesi');
            const garsonlar = JSON.parse(localStorage.getItem("kafe_garsonlari")) || [];
            listBody.innerHTML = "";
            garsonlar.forEach(g => {
                listBody.innerHTML += `
                    <tr>
                        <td>${g.isim}</td>
                        <td>****</td>
                        <td><button onclick="garsonSil(${g.id})" class="btn-sil">Sil</button></td>
                    </tr>`;
            });
        }

        function adminGuncelle() {
            varsayilanMasalariKur();
            const container = document.getElementById('admin-tables-container');
            const masalar = JSON.parse(localStorage.getItem("kafe_masalari")) || [];
            const orders = JSON.parse(localStorage.getItem("orders")) || [];
            const archive = JSON.parse(localStorage.getItem("order_archive")) || [];
            
            container.innerHTML = "";
            let toplamBekleyen = 0;

            masalar.forEach(masaID => {
                const siparis = orders.find(o => o.table.trim() === masaID);
                let masaClass = siparis ? "admin-masa-kutu dolu" : "admin-masa-kutu";
                let durumText = siparis ? "Tutar: " + siparis.total.toFixed(2) + " TL" : "Boş";
                if(siparis) toplamBekleyen += siparis.total;

                container.innerHTML += `
                    <div class="${masaClass}">
                        ${!siparis ? `<button class="btn-masa-sil" onclick="masaSil('${masaID}')"><i class="fas fa-trash-alt"></i></button>` : ''}
                        <i class="fas fa-chair"></i>
                        <span style="font-weight:bold;">${masaID}</span>
                        <span style="font-size:0.9rem; margin-top:5px;">${durumText}</span>
                        ${siparis ? `<button class="btn-odendi" onclick="odemeAl('${masaID}')">ÖDENDİ</button>` : ''}
                    </div>
                `;
            });

            const bugunToplam = archive.reduce((acc, curr) => acc + curr.total, 0);
            document.getElementById('admin-ciro').innerText = bugunToplam.toFixed(2) + " TL";
            document.getElementById('admin-siparis-sayisi').innerText = archive.length;
            document.getElementById('admin-bekleyen').innerText = toplamBekleyen.toFixed(2) + " TL";

            raporListesiniGuncelle();
            urunListesiniGuncelle(); 
            garsonListesiniGuncelle();
        }

        function odemeAl(masaID) {
            let orders = JSON.parse(localStorage.getItem("orders")) || [];
            let archive = JSON.parse(localStorage.getItem("order_archive")) || [];
            const index = orders.findIndex(o => o.table.trim() === masaID);
            if(index !== -1) {
                archive.push(orders[index]);
                localStorage.setItem("order_archive", JSON.stringify(archive));
                orders.splice(index, 1);
                localStorage.setItem("orders", JSON.stringify(orders));
                adminGuncelle();
            }
        }

        function gunuKapat() {
            let archive = JSON.parse(localStorage.getItem("order_archive")) || [];
            if(archive.length === 0) { alert("Tahsil edilmiş sipariş yok!"); return; }
            if(confirm("Günü kapatmak istediğinize emin misiniz?")) {
                const bugunTarih = new Date().toLocaleDateString('tr-TR');
                const bugunToplam = archive.reduce((acc, curr) => acc + curr.total, 0);
                let dailyReports = JSON.parse(localStorage.getItem("daily_reports")) || [];
                const index = dailyReports.findIndex(r => r.date === bugunTarih);
                if(index !== -1) { dailyReports[index].total += bugunToplam; } 
                else { dailyReports.push({ date: bugunTarih, total: bugunToplam }); }
                localStorage.setItem("daily_reports", JSON.stringify(dailyReports));
                localStorage.setItem("order_archive", JSON.stringify([]));
                adminGuncelle();
            }
        }

        function raporListesiniGuncelle() {
            const listContainer = document.getElementById('rapor-listesi');
            const dailyReports = JSON.parse(localStorage.getItem("daily_reports")) || [];
            listContainer.innerHTML = "";
            if(dailyReports.length === 0) {
                listContainer.innerHTML = "<p style='color:#666; text-align:center;'>Geçmiş rapor yok.</p>";
                return;
            }
            [...dailyReports].reverse().forEach(rapor => {
                listContainer.innerHTML += `
                    <div class="gunluk-rapor-item">
                        <span class="rapor-tarih">${rapor.date}</span>
                        <span class="rapor-tutar">${rapor.total.toFixed(2)} TL</span>
                    </div>`;
            });
        }

        function setCategoryFilter(cat, btn) {
            currentCategoryFilter = cat;
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            urunListesiniGuncelle();
        }

        function urunEkle() {
            const ad = document.getElementById('yeni-urun-ad').value;
            const fiyat = document.getElementById('yeni-urun-fiyat').value;
            const kategori = document.getElementById('yeni-urun-kategori').value;
            const resim = document.getElementById('yeni-urun-resim').value;
            if(!ad || !fiyat) { alert("Ad ve fiyat girin!"); return; }
            let urunler = JSON.parse(localStorage.getItem("yonetilen_urunler")) || [];
            urunler.push({ id: Date.now(), ad, fiyat, kategori, resim: resim || 'images/default.png' });
            localStorage.setItem("yonetilen_urunler", JSON.stringify(urunler));
            formuSifirla();
            urunListesiniGuncelle();
        }

        function urunDuzenleHazirla(id) {
            let urunler = JSON.parse(localStorage.getItem("yonetilen_urunler")) || [];
            const urun = urunler.find(u => u.id === id);
            if (urun) {
                document.getElementById('yeni-urun-ad').value = urun.ad;
                document.getElementById('yeni-urun-fiyat').value = urun.fiyat;
                document.getElementById('yeni-urun-kategori').value = urun.kategori;
                document.getElementById('yeni-urun-resim').value = urun.resim;
                const ekleButon = document.getElementById('btn-urun-ekle-main');
                ekleButon.innerText = "Güncelle";
                ekleButon.style.background = "#3498db";
                ekleButon.onclick = urunGuncelle;
                duzenlenenUrunId = id;
                window.scrollTo({ top: document.querySelector('.urun-form-row').offsetTop - 100, behavior: 'smooth' });
            }
        }

        function urunGuncelle() {
            const ad = document.getElementById('yeni-urun-ad').value;
            const fiyat = document.getElementById('yeni-urun-fiyat').value;
            const kategori = document.getElementById('yeni-urun-kategori').value;
            const resim = document.getElementById('yeni-urun-resim').value;
            let urunler = JSON.parse(localStorage.getItem("yonetilen_urunler")) || [];
            const index = urunler.findIndex(u => u.id === duzenlenenUrunId);
            if (index !== -1) {
                urunler[index].ad = ad;
                urunler[index].fiyat = fiyat;
                urunler[index].kategori = kategori;
                urunler[index].resim = resim;
                localStorage.setItem("yonetilen_urunler", JSON.stringify(urunler));
                formuSifirla();
                urunListesiniGuncelle();
            }
        }

        function formuSifirla() {
            document.getElementById('yeni-urun-ad').value = "";
            document.getElementById('yeni-urun-fiyat').value = "";
            document.getElementById('yeni-urun-resim').value = "";
            const ekleButon = document.getElementById('btn-urun-ekle-main');
            ekleButon.innerText = "Ekle";
            ekleButon.style.background = "#e84242";
            ekleButon.onclick = urunEkle;
            duzenlenenUrunId = null;
        }

        function urunSil(id) {
            if(confirm("Silinsin mi?")) {
                let urunler = JSON.parse(localStorage.getItem("yonetilen_urunler")) || [];
                urunler = urunler.filter(u => u.id !== id);
                localStorage.setItem("yonetilen_urunler", JSON.stringify(urunler));
                urunListesiniGuncelle();
            }
        }

        function urunListesiniGuncelle() {
            const listBody = document.getElementById('admin-urun-listesi-body');
            const urunler = JSON.parse(localStorage.getItem("yonetilen_urunler")) || [];
            listBody.innerHTML = "";
            const filtrelenmisUrunler = currentCategoryFilter === 'all' ? urunler : urunler.filter(u => u.kategori === currentCategoryFilter);
            if(filtrelenmisUrunler.length === 0) { listBody.innerHTML = "<tr><td colspan='3' style='text-align:center; color:#666;'>Ürün yok.</td></tr>"; return; }
            filtrelenmisUrunler.forEach(u => {
                listBody.innerHTML += `
                    <tr>
                        <td>${u.ad}</td>
                        <td>${u.fiyat} TL</td>
                        <td>
                            <button class="btn-duzenle" onclick="urunDuzenleHazirla(${u.id})">Düzenle</button>
                            <button class="btn-sil" onclick="urunSil(${u.id})">Sil</button>
                        </td>
                    </tr>`;
            });
        }

        adminGuncelle();
        setInterval(adminGuncelle, 3000);
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

<script>
  // Yukarıdaki firebaseConfig kodlarını buraya yapıştır
  const firebaseConfig = {
    apiKey: "AIzaSyC2ZRTGSOvdJR1sQw1MSTAG94zFHDTZc7g",
    authDomain: "bogazcafee.firebaseapp.com",
    projectId: "bogazcafee",
    storageBucket: "bogazcafee.firebasestorage.app",
    messagingSenderId: "58612336622",
    appId: "1:58612336622:web:134c5d3940324920ea38ff",
    measurementId: "G-X61H9KD691"
  };

  // Firebase'i Başlat
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>
</body>
</html>
